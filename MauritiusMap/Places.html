<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Places</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/StyleSheet1.css">
</head>
<body class="bg-light">
    <div class="d-flex">
        <aside class="sidebar bg-white border-end" style="width: 250px; min-height: 100vh;">
            <nav class="p-3">
                <h5>🛡️ Admin Panel</h5>
                <hr>
                <a class="nav-link" href="dashboard.html">Dashboard</a>
                <a class="nav-link" href="categories.html">Categories</a>
                <a class="nav-link active" href="places.html">Places</a>
                <a class="nav-link text-danger" href="login.html">Logout</a>
            </nav>
        </aside>

        <main class="flex-grow-1 p-4">
            <h4>Manage Places</h4>

            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <form id="addPlaceForm" class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Place Name</label>
                            <input type="text" id="placeName" class="form-control" placeholder="e.g., Le Morne" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Category</label>
                            <select id="categorySelect" class="form-select" required>
                                <option value="">Select Category...</option>
                                </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">Add Place</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="placesTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 1. Load Categories into Dropdown
        async function loadCategoriesForDropdown() {
            const res = await fetch('./api/get_categories.php');
            const categories = await res.json();
            const select = document.getElementById('categorySelect');
            select.innerHTML = '<option value="">Select Category...</option>' + 
                categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        async function loadPlaces() {
            const res = await fetch('./api/get_places.php');
            const places = await res.json();
          document.getElementById('placesTableBody').innerHTML = places.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.Title}</td> <td><span class="badge bg-info text-dark">${p.category_name || 'Uncategorized'}</span></td>
                    <td>${p.Status}</td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-danger" onclick="deletePlace(${p.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
                    }

        //Add New Place
        document.getElementById('addPlaceForm').onsubmit = async (e) => {
            e.preventDefault();
            const name = document.getElementById('placeName').value;
            const category_id = document.getElementById('categorySelect').value;

            const title = document.getElementById('placeName').value; // Ensure this captures the Title
            await fetch('./api/add_place.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: title, category_id: category_id }) // Sending 'title'
            });
            
            document.getElementById('addPlaceForm').reset();
            loadPlaces();
        };

        // Initialize
        loadCategoriesForDropdown();
        loadPlaces();
    </script>
</body>
</html>